<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mini Frontend Unificado</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f8f9fa;
            padding: 25px;
        }
        .card {
            margin-bottom: 25px;
            border-radius: 12px;
        }
        .result {
            background: #eef0f2;
            padding: 12px;
            white-space: pre-wrap;
            border-radius: 8px;
        }
    </style>
</head>

<body>

<div class="container">

    <h1 class="text-center mb-4 fw-bold">Frontend Unificado — Alumnos / Cursos / Calificaciones</h1>

    <!-- ========================================================= -->
    <!-- ======================= ALUMNOS ========================= -->
    <!-- ========================================================= -->

    <div class="card shadow">
        <div class="card-body">
            <h2 class="mb-3 text-primary">Alumnos (SOAP vía Proxy REST)</h2>

            <!-- Registrar Alumno -->
            <h4 class="mt-4">Registrar Alumno</h4>
            <div class="row g-2">
                <div class="col-md-2"><input id="matricula" class="form-control" placeholder="Matrícula" required></div>
                <div class="col-md-3"><input id="curp" class="form-control" placeholder="CURP (18 caracteres)" maxlength="18"></div>
                <div class="col-md-2"><input id="nombre" class="form-control" placeholder="Nombre"></div>
                <div class="col-md-2"><input id="apellido" class="form-control" placeholder="Apellido"></div>
                <div class="col-md-3"><input id="email" type="email" class="form-control" placeholder="Email"></div>
            </div>
            <button class="btn btn-primary mt-2" onclick="registrarAlumno()">Guardar</button>

            <!-- Consultar -->
            <h4 class="mt-4">Consultar Alumno</h4>
            <div class="input-group">
                <input id="buscarMatricula" class="form-control" placeholder="Matrícula">
                <button class="btn btn-secondary" onclick="consultarAlumno()">Buscar</button>
            </div>

            <!-- Editar -->
            <h4 class="mt-4">Editar Alumno</h4>
            <div class="row g-2">
                <div class="col-md-2"><input id="editMatricula" class="form-control" placeholder="Matrícula"></div>
                <div class="col-md-3"><input id="editNombre" class="form-control" placeholder="Nuevo nombre"></div>
                <div class="col-md-3"><input id="editApellido" class="form-control" placeholder="Nuevo apellido"></div>
                <div class="col-md-3"><input id="editEmail" type="email" class="form-control" placeholder="Nuevo email"></div>
                <div class="col-md-1">
                    <select id="editEstatus" class="form-select">
                        <option value="ACTIVO">Activo</option>
                        <option value="BAJA_TEMPORAL">Baja Temporal</option>
                        <option value="EGRESADO">Egresado</option>
                        <option value="SUSPENDIDO">Suspendido</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-warning mt-2" onclick="editarAlumno()">Editar</button>

            <!-- Eliminar -->
            <h4 class="mt-4">Eliminar Alumno</h4>
            <div class="input-group">
                <input id="deleteMatricula" class="form-control" placeholder="Matrícula">
                <button class="btn btn-danger" onclick="eliminarAlumno()">Eliminar</button>
            </div>

            <div id="alumnosResult" class="result mt-3"></div>
        </div>
    </div>



    <!-- ========================================================= -->
    <!-- ======================= CURSOS ========================== -->
    <!-- ========================================================= -->

    <div class="card shadow">
        <div class="card-body">
            <h2 class="mb-3 text-success">Cursos (API REST)</h2>

            <!-- Registrar Curso -->
            <h4 class="mt-4">Registrar Curso</h4>
            <div class="row g-2">
                <div class="col-md-3"><input id="cursoNombre" class="form-control" placeholder="Nombre"></div>
                <div class="col-md-3"><input id="cursoDescripcion" class="form-control" placeholder="Descripción"></div>
                <div class="col-md-3"><input id="cursoProfesor" class="form-control" placeholder="Profesor"></div>
                <div class="col-md-3"><input id="cursoHorario" class="form-control" placeholder="Horario (HH:MM-HH:MM)"></div>

                <div class="col-md-4">
                    <label>Fecha Inicio</label>
                    <input id="cursoInicio" type="datetime-local" class="form-control">
                </div>
                <div class="col-md-4">
                    <label>Fecha Fin</label>
                    <input id="cursoFin" type="datetime-local" class="form-control">
                </div>

                <div class="col-md-2"><input id="cursoCreditos" type="number" min="1" class="form-control" placeholder="Créditos"></div>
                <div class="col-md-2"><input id="cursoCupo" type="number" min="1" class="form-control" placeholder="Cupo Máx"></div>
            </div>

            <button class="btn btn-success mt-2" onclick="registrarCurso()">Guardar</button>

            <!-- Eliminar -->
            <h4 class="mt-4">Eliminar por ID</h4>
            <div class="input-group mb-2">
                <input id="delCursoId" class="form-control" placeholder="ID del curso">
                <button class="btn btn-danger" onclick="eliminarCursoId()">Eliminar</button>
            </div>

            <h4>Eliminar por Nombre</h4>
            <div class="input-group mb-2">
                <input id="delCursoNombre" class="form-control" placeholder="Nombre del curso">
                <button class="btn btn-danger" onclick="eliminarCursoNombre()">Eliminar</button>
            </div>

            <h4>Eliminar por Fecha de Inicio</h4>
            <div class="input-group mb-2">
                <input id="delCursoFecha" type="datetime-local" class="form-control">
                <button class="btn btn-danger" onclick="eliminarCursoFecha()">Eliminar</button>
            </div>

            <div id="cursosResult" class="result mt-3"></div>
        </div>
    </div>



    <!-- ========================================================= -->
    <!-- ==================== CALIFICACIONES ===================== -->
    <!-- ========================================================= -->

    <div class="card shadow">
        <div class="card-body">
            <h2 class="mb-3 text-danger">Calificaciones (API REST)</h2>

            <h4>Registrar Calificación</h4>
            <div class="row g-2">
                <div class="col-md-3"><input id="calMatricula" class="form-control" placeholder="Matrícula"></div>
                <div class="col-md-3"><input id="calMateria" class="form-control" placeholder="Materia"></div>
                <div class="col-md-3"><input id="calValor" type="number" class="form-control" placeholder="Calificación (0–100)" min="0" max="100"></div>
            </div>
            <button class="btn btn-danger mt-2" onclick="registrarCalificacion()">Registrar</button>

            <h4 class="mt-4">Ver todas</h4>
            <button class="btn btn-secondary" onclick="verCalificaciones()">Listar</button>

            <h4 class="mt-4">Ver por Alumno</h4>
            <div class="input-group">
                <input id="calBuscarMatricula" class="form-control" placeholder="Matrícula del alumno">
                <button class="btn btn-secondary" onclick="verCalificacionesAlumno()">Buscar</button>
            </div>

            <div id="calificacionesResult" class="result mt-3"></div>
        </div>
    </div>

</div>





<!-- ========================================================= -->
<!-- ====================== JAVASCRIPT ======================== -->
<!-- ========================================================= -->

<script>
// =============================================================
// ===================== VALIDACIONES ==========================
// =============================================================

/* ------------------------- ALUMNOS ------------------------- */
async function registrarAlumno() {
    const data = {
        matricula: matricula.value.trim(),
        curp: curp.value.trim(),
        nombre: nombre.value.trim(),
        apellido: apellido.value.trim(),
        email: email.value.trim()
    };

    if (!data.matricula) return alumnosResult.textContent = "❌ Matrícula requerida.";
    if (data.curp.length !== 18) return alumnosResult.textContent = "❌ CURP debe tener 18 caracteres.";
    if (!data.nombre) return alumnosResult.textContent = "❌ Nombre requerido.";
    if (!data.apellido) return alumnosResult.textContent = "❌ Apellido requerido.";

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(data.email)) return alumnosResult.textContent = "❌ Email inválido.";

    send("/api/alumnos", "POST", data, alumnosResult);
}

async function consultarAlumno() {
    const m = buscarMatricula.value.trim();
    if (!m) return alumnosResult.textContent = "❌ Ingresa matrícula.";
    send(`/api/alumnos/${m}`, "GET", null, alumnosResult);
}

async function editarAlumno() {
    const m = editMatricula.value.trim();
    if (!m) return alumnosResult.textContent = "❌ Ingresa matrícula.";

    const data = {
        nombre: editNombre.value.trim(),
        apellido: editApellido.value.trim(),
        email: editEmail.value.trim(),
        estatus: editEstatus.value
    };

    if (!data.nombre) return alumnosResult.textContent = "❌ Nombre requerido.";
    if (!data.apellido) return alumnosResult.textContent = "❌ Apellido requerido.";

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(data.email)) return alumnosResult.textContent = "❌ Email inválido.";

    send(`/api/alumnos/${m}`, "PUT", data, alumnosResult);
}

async function eliminarAlumno() {
    const m = deleteMatricula.value.trim();
    if (!m) return alumnosResult.textContent = "❌ Ingresa matrícula.";
    send(`/api/alumnos/${m}`, "DELETE", null, alumnosResult);
}



/* ------------------------- CURSOS ------------------------- */
async function registrarCurso() {
    const data = {
        nombre: cursoNombre.value.trim(),
        descripcion: cursoDescripcion.value.trim(),
        profesor: cursoProfesor.value.trim(),
        fechaInicio: cursoInicio.value,
        fechaFin: cursoFin.value,
        horario: cursoHorario.value.trim(),
        creditos: Number(cursoCreditos.value),
        cupoMaximo: Number(cursoCupo.value)
    };

    if (!data.nombre) return cursosResult.textContent = "❌ Nombre requerido.";
    if (!data.descripcion) return cursosResult.textContent = "❌ Descripción requerida.";
    if (!data.profesor) return cursosResult.textContent = "❌ Profesor requerido.";
    if (!data.fechaInicio) return cursosResult.textContent = "❌ Fecha inicio requerida.";
    if (!data.fechaFin) return cursosResult.textContent = "❌ Fecha fin requerida.";

    const inicio = new Date(data.fechaInicio);
    const fin = new Date(data.fechaFin);
    if (fin <= inicio) return cursosResult.textContent = "❌ Fecha fin debe ser después de inicio.";

    if (!/^\d{2}:\d{2}\-\d{2}:\d{2}$/.test(data.horario))
        return cursosResult.textContent = "❌ Horario inválido (HH:MM-HH:MM).";

    if (data.creditos < 1) return cursosResult.textContent = "❌ Créditos deben ser ≥ 1.";
    if (data.cupoMaximo < 1) return cursosResult.textContent = "❌ Cupo máximo debe ser ≥ 1.";

    send("/api/cursos", "POST", data, cursosResult);
}

async function eliminarCursoId() {
    const id = delCursoId.value.trim();
    if (!id) return cursosResult.textContent = "❌ Ingresa ID.";
    send(`/api/cursos/${id}`, "DELETE", null, cursosResult);
}

async function eliminarCursoNombre() {
    const nombre = delCursoNombre.value.trim();
    if (!nombre) return cursosResult.textContent = "❌ Ingresa nombre.";
    send(`/api/cursos/nombre/${nombre}`, "DELETE", null, cursosResult);
}

async function eliminarCursoFecha() {
    const fecha = delCursoFecha.value;
    if (!fecha) return cursosResult.textContent = "❌ Selecciona fecha.";
    send(`/api/cursos/fecha-inicio/${fecha}`, "DELETE", null, cursosResult);
}



/* -------------------- CALIFICACIONES ----------------------- */
async function registrarCalificacion() {
    const data = {
        matriculaAlumno: calMatricula.value.trim(),
        materia: calMateria.value.trim(),
        calificacion: Number(calValor.value)
    };

    if (!data.matriculaAlumno) return calificacionesResult.textContent = "❌ Matrícula requerida.";
    if (!data.materia) return calificacionesResult.textContent = "❌ Materia requerida.";
    if (isNaN(data.calificacion) || data.calificacion < 0 || data.calificacion > 100)
        return calificacionesResult.textContent = "❌ Calificación debe ser 0–100.";

    send("/api/calificaciones", "POST", data, calificacionesResult);
}

async function verCalificaciones() {
    send("/api/calificaciones", "GET", null, calificacionesResult);
}

async function verCalificacionesAlumno() {
    const m = calBuscarMatricula.value.trim();
    if (!m) return calificacionesResult.textContent = "❌ Ingresa matrícula.";
    send(`/api/calificaciones/alumno/${m}`, "GET", null, calificacionesResult);
}



// =============================================================
// =============== MÉTODO GENERAL PARA AJAX ====================
// =============================================================
async function send(url, method, body, output) {
    try {
        const res = await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: body ? JSON.stringify(body) : null
        });

        const text = await res.text();
        output.textContent = text;
    } catch (e) {
        output.textContent = "❌ Error: " + e;
    }
}
</script>

</body>
</html>
